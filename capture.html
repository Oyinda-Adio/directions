<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Accurate GPS Location</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial; padding: 16px; }
    #status { margin-top: 12px; font-size: 0.95rem; color: #333; white-space: pre-line; }
    button { margin-top: 10px; padding: 8px 14px; border: none; border-radius: 6px; background: #0b63c6; color: white; cursor: pointer; }
    button.secondary { background: #666; }
  </style>
</head>
<body>
  <h2>üìç GPS Location with Accuracy</h2>
  <button id="getLoc">Start Location</button>
  <button id="saveLoc" class="secondary" disabled>Save Location</button>
  <div id="status">Waiting...</div>

<script>
let watchId = null;
let currentPosition = null;
let hasSaved = false;

const status = document.getElementById("status");
const getLocBtn = document.getElementById("getLoc");
const saveLocBtn = document.getElementById("saveLoc");

function startWatching() {
  if (!navigator.geolocation) {
    status.textContent = "‚ùå Geolocation not supported by this browser.";
    return;
  }

  status.textContent = "‚è≥ Getting GPS fix...";

  watchId = navigator.geolocation.watchPosition(
    (pos) => {
      const { latitude, longitude, accuracy } = pos.coords;
      currentPosition = { latitude, longitude, accuracy };

      // Show live updates
      status.textContent = `Lat: ${latitude}\nLon: ${longitude}\nAccuracy: ¬±${accuracy}m`;

      if (accuracy <= 50) {
        status.textContent += "\n‚úÖ High accuracy fix obtained!";
      } else {
        status.textContent += "\n‚ö†Ô∏è Accuracy not great. Please wait 1‚Äì2 minutes for better results.";
      }

      // Enable Save button always
      saveLocBtn.disabled = false;
    },
    (err) => {
      status.textContent = "‚ö†Ô∏è Error: " + err.message;
    },
    {
      enableHighAccuracy: true,
      timeout: 30000,
      maximumAge: 0
    }
  );
}

function stopWatching() {
  if (watchId) {
    navigator.geolocation.clearWatch(watchId);
    watchId = null;
  }
}

getLocBtn.addEventListener("click", () => {
  stopWatching();
  startWatching();
  getLocBtn.disabled = true;
});

saveLocBtn.addEventListener("click", () => {
  if (!currentPosition) {
    alert("No location yet!");
    return;
  }

  alert(`üìç Location saved:\nLat: ${currentPosition.latitude}\nLon: ${currentPosition.longitude}\nAccuracy: ¬±${currentPosition.accuracy}m`);

  hasSaved = true;
  saveLocBtn.textContent = "Update Location";
  getLocBtn.disabled = false; // allow restarting scan
  stopWatching();
});
</script>
</body>
</html>
